<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EPIROC FLEET PARAMETER ENTRY FORM</title>
    <style>
        body { font-family: 'Segoe UI', Arial, sans-serif; background-color: #f0f2f5; padding: 20px; margin: 0; }
        .header-section { max-width: 700px; margin: 0 auto 10px auto; display: flex; flex-direction: column; align-items: flex-start; }
        .brand-logo { max-width: 160px; height: auto; margin-bottom: 10px; }
        h2 { margin: 0; font-size: 20px; color: #333; width: 100%; text-align: center; padding-bottom: 15px; }
        .sheet-container { background: white; border: 1px solid #ccc; box-shadow: 0 2px 10px rgba(0,0,0,0.1); max-width: 700px; margin: 0 auto; border-radius: 8px; overflow: hidden; }
        table { border-collapse: collapse; width: 100%; }
        td { border: 1px solid #dfe3e8; padding: 12px; font-size: 14px; }
        tr:nth-child(odd) .label-cell { background-color: #FFD700 !important; color: #000 !important; font-weight: bold; width: 45%; }
        tr:nth-child(even) .label-cell { background-color: #555555 !important; color: #ffffff !important; font-weight: bold; width: 45%; }
        input, select { width: 100%; padding: 8px; border: 1px solid #ced4da; border-radius: 4px; box-sizing: border-box; }
        .hidden { display: none; }
         /* Updated Button Group Container */
        #formButtons { 
            padding: 30px; 
            text-align: center; 
            background: #f8f9fa; 
            border-top: 1px solid #ddd; 
        }

        /* The New "Beautiful" Submit Button */
        #submitBtn {
            background: linear-gradient(135deg, #FFD700 0%, #FFB800 100%); /* Epiroc Golden Yellow */
            color: #1a1a1a;
            border: 2px solid #CC9900;
            padding: 16px 60px;
            font-size: 18px;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 1px;
            border-radius: 50px; /* Rounded pill shape */
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        /* Hover Effect - Grows and glows when valid */
        #submitBtn:hover:not(:disabled) {
            background: linear-gradient(135deg, #FFB800 0%, #FFD700 100%);
            transform: scale(1.05); 
            box-shadow: 0 8px 25px rgba(255, 184, 0, 0.4);
        }

        /* Click Effect */
        #submitBtn:active:not(:disabled) {
            transform: scale(0.98);
        }

        /* Disabled State - Matches your form's clean look */
        #submitBtn:disabled {
            background: #e0e0e0 !important;
            color: #9e9e9e !important;
            border: 2px solid #bdbdbd !important;
            box-shadow: none !important;
            cursor: not-allowed;
            transform: none !important;
        }

        /* Status Tags */
        .status-tag { padding: 4px 12px; border-radius: 12px; font-size: 12px; font-weight: bold; }
        .locked { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .unlocked { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .required-star { color: #dc3545; }
    </style>
</head>
<body>

    <div class="header-section">
        <img src="Picture1.png" alt="Epiroc Logo" class="brand-logo" onerror="this.style.display='none'">
        <h2>EPIROC FLEET PARAMETER ENTRY FORM</h2>
    </div>

   <form id="residencyForm">
    <div class="sheet-container">
        <table>
            <tr><td class="label-cell">Customer Name <span class="required-star">*</span></td><td><select id="customerSelect" name="Customer Name" onchange="updateSites(); checkValidation();" required><option value="">-- Select --</option><option value="TATA STEEL LTD">TATA STEEL LTD</option><option value="ULTRATECH LTD">ULTRATECH LTD</option><option value="AMBUJA CEMENTS LTD">AMBUJA CEMENTS LTD</option><option value="ACC LTD">ACC LTD</option><option value="LAFARGE">LAFARGE</option><option value="JSW LTD">JSW LTD</option><option value="ADANI ENTERPRISES">ADANI ENTERPRISES</option><option value="NMDC LTD">NMDC LTD</option><option value="BIRLA CORPORATION LIMITED">BIRLA CORPORATION LIMITED</option><option value="GANPATI METAL MINING">GANPATI METAL MINING</option></select></td></tr>
            <tr><td class="label-cell">Date <span class="required-star">*</span></td><td><input type="date" name="Date" id="valDate" oninput="checkValidation()" required></td></tr>
            <tr><td class="label-cell">Technician Name <span class="required-star">*</span></td><td><input type="text" name="Technician Name" id="valTech" oninput="checkValidation()" required></td></tr>
            <tr><td class="label-cell">Unlock Password</td><td><input type="password" id="passInput" placeholder="Enter password to unlock"></td></tr>
            <tr><td class="label-cell">Status</td><td><span id="statusLabel" class="status-tag locked">Locked</span></td></tr>

            <tbody id="protectedContent" class="hidden">
    <tr><td class="label-cell">Work Site <span class="required-star">*</span></td><td><select id="workSiteSelect" name="Work Site" onchange="updateFleet(); checkValidation();"><option value="">-- Select Site --</option></select></td></tr>
    <tr><td class="label-cell">Fleet ID <span class="required-star">*</span></td><td><select id="fleetSelect" name="Fleet ID" onchange="checkValidation()"><option value="">-- Select Fleet --</option></select></td></tr>
    <tr><td class="label-cell">Recent Entry Lookup</td><td><button type="button" onclick="lookupRecentData()" style="background:#007bff; color:white; width:100%;">Fetch Last Entry for this Fleet</button></td></tr>
    <tr><td class="label-cell">Shift <span class="required-star">*</span></td><td><select name="Shift" id="valShift" onchange="checkValidation()"><option value="">-- Select Shift --</option><option>Shift A</option><option>Shift B</option><option>Shift C</option><option>G Shift</option></select></td></tr>

    <tr><td class="label-cell">Rotation Pressure</td><td><input type="number" step="any" name="Rotation Pressure" min="0" max="120" placeholder="Enter Rotation Pressure" oninput="checkValidation()"></td></tr>
    <tr><td class="label-cell">Rotation RPM</td><td><input type="number" step="any" name="Rotation RPM" min="0" max="180" placeholder="Enter Rotation RPM (Smartroc & PV)" oninput="checkValidation()"></td></tr>
    <tr><td class="label-cell">Receiver Pr NoLoad</td><td><input type="number" step="any" name="Receiver Pr NoLoad" min="0" max="16" placeholder="Enter Receiver Pr NoLoad (DTH & DS)" oninput="checkValidation()"></td></tr>
    <tr><td class="label-cell">Receiver Pr Unload</td><td><input type="number" step="any" name="Receiver Pr Unload" min="0" max="30" placeholder="Enter Receiver Pr Unload (DTH & DS)" oninput="checkValidation()"></td></tr>
    <tr><td class="label-cell">Receiver Pr Load</td><td><input type="number" step="any" name="Receiver Pr Load" min="0" max="30" placeholder="Enter Receiver Pr Load (DTH & DS)" oninput="checkValidation()"></td></tr>
    <tr><td class="label-cell">Reduced Air pressure</td><td><input type="number" step="any" name="Reduced Air pressure" min="0" max="30" placeholder="Enter Reduced Air pressure (DTH)" oninput="checkValidation()"></td></tr>
    <tr><td class="label-cell">Full Air Set Pr</td><td><input type="number" step="any" name="Full Air Set Pr" min="0" max="30" placeholder="Enter Full Air Set Pr (DTH)" oninput="checkValidation()"></td></tr>
    
    <tr><td class="label-cell">Low Impact</td><td><input type="number" step="any" name="Low Impact" min="0" max="250" placeholder="Enter Low Impact (Top Hammer)" oninput="checkValidation()"></td></tr>
    <tr><td class="label-cell">Air Pressure Full</td><td><input type="number" step="any" name="Air Pressure Full" min="0" max="30" placeholder="Enter Air Pressure Full" oninput="checkValidation()"></td></tr>
    <tr><td class="label-cell">Interstage Pr Load</td><td><input type="number" step="any" name="Interstage Pr Load" min="0" max="30" placeholder="Enter Interstage Pr Load (DTH)" oninput="checkValidation()"></td></tr>
    <tr><td class="label-cell">Feed Pr Low Impact</td><td><input type="number" step="any" name="Feed Pr Low Impact" min="0" max="150" placeholder="Enter Feed Pr Low Impact" oninput="checkValidation()"></td></tr>
    <tr><td class="label-cell">Feed Pr High Impact</td><td><input type="number" step="any" name="Feed Pr High Impact" min="0" max="150" placeholder="Enter Feed Pr High Impact" oninput="checkValidation()"></td></tr>
    <tr><td class="label-cell">HECL pr High Impact</td><td><input type="number" step="any" name="HECL pr High Impact" min="0" max="30" placeholder="Enter HECL pr High Impact" oninput="checkValidation()"></td></tr>
    
    <tr><td class="label-cell">DCT %</td><td><input type="number" step="any" name="DCT %" min="0" max="100" placeholder="Enter DCT (%)" oninput="checkValidation()"></td></tr>
    <tr><td class="label-cell">Water injection %</td><td><input type="number" step="any" name="Water injection %" min="0" max="100" placeholder="Enter Water injection (%)" oninput="checkValidation()"></td></tr>
    <tr><td class="label-cell">Compressor Load</td><td><input type="number" step="any" name="Compressor Load" min="0" max="100" placeholder="Enter Compressor Load (Smartroc & PV)" oninput="checkValidation()"></td></tr>
    
    <tr><td class="label-cell">Engine RPM Drilling</td><td><input type="number" step="any" name="Engine RPM Drilling" min="800" max="2500" placeholder="Enter Engine RPM Drilling" oninput="checkValidation()"></td></tr>
    <tr><td class="label-cell">Engine Temp <span class="required-star">*</span></td><td><input type="number" step="any" name="Engine Temp" id="valEngTemp" min="50" max="130" placeholder="Enter Engine Temp" oninput="checkValidation()"></td></tr>
    <tr><td class="label-cell">Hyd-Oil Temp</td><td><input type="number" step="any" name="Hyd-Oil Temp" min="0" max="100" placeholder="Enter Hyd-Oil Temp" oninput="checkValidation()"></td></tr>
    <tr><td class="label-cell">Ambient Temp</td><td><input type="number" step="any" name="Ambient Temp" min="-55" max="55" placeholder="Enter Ambient Temp" oninput="checkValidation()"></td></tr>
    <tr><td class="label-cell">Engine load Drilling</td><td><input type="number" step="any" name="Engine load Drilling" min="0" max="100" placeholder="Enter Engine load Drilling" oninput="checkValidation()"></td></tr>
    <tr><td class="label-cell">Boost Pressure</td><td><input type="number" step="any" name="Boost Pressure" min="0" max="2" placeholder="Enter Boost Pressure" oninput="checkValidation()"></td></tr>
    <tr><td class="label-cell">Engine oil pressure <span class="required-star">*</span></td><td><input type="number" step="any" name="Engine oil pressure" id="valEngOil" min="0" max="8" placeholder="Enter Engine oil pressure" oninput="checkValidation()"></td></tr>
    
    <tr><td class="label-cell">Air intake temp</td><td><input type="number" step="any" name="Air intake temp" min="0" max="100" placeholder="Enter Air intake temp" oninput="checkValidation()"></td></tr>
    <tr><td class="label-cell">Compressor Temp (L & DS)</td><td><input type="number" step="any" name="Compressor Temp (L & DS)" min="0" max="150" placeholder="Enter Compressor Temp" oninput="checkValidation()"></td></tr>
    <tr><td class="label-cell">Compressor Temp (H)</td><td><input type="number" step="any" name="Compressor Temp (H)" min="0" max="150" placeholder="Enter Compressor Temp (SRT40-T45 & DTH)" oninput="checkValidation()"></td></tr>
    <tr><td class="label-cell">Charging Voltage</td><td><input type="number" step="any" name="Charging Voltage" min="0" max="32" placeholder="Enter Charging Voltage" oninput="checkValidation()"></td></tr>
    <tr><td class="label-cell">Fuel Pressure</td><td><input type="number" step="any" name="Fuel Pressure" min="0" max="25" placeholder="Enter Fuel Pressure" oninput="checkValidation()"></td></tr>
    <tr><td class="label-cell">Tramming</td><td><input type="number" step="any" name="Tramming" min="0" max="100" placeholder="Enter Tramming" oninput="checkValidation()"></td></tr>
    <tr><td class="label-cell">Y193 Inlet Pressure</td><td><input type="number" step="any" name="Y193 Inlet Pressure" min="0" max="30" placeholder="Enter Y193 Inlet Pressure (Smartroc)" oninput="checkValidation()"></td></tr>
    <tr><td class="label-cell">High Impact</td><td><input type="number" step="any" name="High Impact" min="0" max="280" placeholder="Enter High Impact (Top Hammer)" oninput="checkValidation()"></td></tr>
    <tr><td class="label-cell">Damper Pressure High</td><td><input type="number" step="any" name="Damper Pressure High" min="0" max="250" placeholder="Enter Damper Pressure High (Top Hammer)" oninput="checkValidation()"></td></tr>
    <tr><td class="label-cell">Feed Pr Coupling</td><td><input type="number" step="any" name="Feed Pr Coupling" min="0" max="250" placeholder="Enter Feed Pr Coupling" oninput="checkValidation()"></td></tr>
    <tr><td class="label-cell">Feed Pr Uncoupling</td><td><input type="number" step="any" name="Feed Pr Uncoupling" min="0" max="250" placeholder="Enter Feed Pr Uncoupling" oninput="checkValidation()"></td></tr>
    <tr><td class="label-cell">Rotation Pr Rod To Rod</td><td><input type="number" step="any" name="Rotation Pr Rod To Rod" min="0" max="160" placeholder="Enter Rotation Pr Rod To Rod" oninput="checkValidation()"></td></tr>
</tbody>
        </table>
    </div>

    <div id="formButtons" class="hidden">
        <button type="submit" id="submitBtn" disabled>
            üöÄ Submit Fleet Log Record
        </button>
    </div>
</form>

    <script>
    // Scrambled Connection (Updated with your Version 32+ URL)
    var _0x1a2b = [
        "\x45\x70\x69\x72\x6f\x63\x40\x31\x32\x33", // Hex for 'Epiroc@123'
        "\x68\x74\x74\x70\x73\x3a\x2f\x2f\x73\x63\x72\x69\x70\x74\x2e\x67\x6f\x6f\x67\x6c\x65\x2e\x63\x6f\x6d\x2f\x6d\x61\x63\x72\x6f\x73\x2f\x73\x2f\x41\x4b\x66\x79\x63\x62\x79\x35\x47\x4d\x64\x34\x4f\x39\x52\x4a\x34\x43\x39\x78\x7a\x4f\x54\x6a\x31\x31\x78\x51\x47\x7a\x4e\x54\x6a\x32\x2d\x63\x47\x76\x63\x4e\x6c\x43\x46\x30\x71\x39\x6d\x56\x66\x72\x6b\x73\x46\x36\x4c\x6f\x70\x7a\x4b\x36\x62\x38\x45\x6a\x42\x46\x45\x74\x68\x52\x6c\x76\x66\x67\x2f\x65\x78\x65\x63"
    ];

    const scriptURL = _0x1a2b[1];
    const passKey = _0x1a2b[0];
    // New Data Fetch Implementation
    function lookupRecentData() {
    const fId = document.getElementById('fleetSelect').value;
    if (!fId) { alert("Select Fleet ID first"); return; }
    
    const btn = event.target;
    btn.innerText = "Searching..."; btn.disabled = true;

    fetch(scriptURL + "?fleetId=" + encodeURIComponent(fId))
    .then(r => r.json())
    .then(d => {
        if (d && d.length > 0) {
            const ins = document.querySelectorAll('input[type="number"]');
            ins.forEach((input, i) => { 
                if(d[i+8] !== undefined && d[i+8] !== "") {
                    input.value = d[i+8];
                }
            });
            alert("Latest parameters for " + fId + " loaded successfully.");
        } else { 
            // Your custom message for Phase II
            alert("Under Progress. Will be functional shortly."); 
        }
    })
    .catch(e => {
        // Your custom message for the connection error
        alert("Under Progress. Will be functional shortly.");
    })
    .finally(() => { 
        btn.innerText = "Fetch Last Entry for this Fleet"; 
        btn.disabled = false; 
    });
}
 // --- Technical Logic ---
    const customerToSites = { "TATA STEEL LTD": ["Noamundi Iron Ore Mines", "Khondbond Iron Ore Mines", "TSL West Bokaro Q-SE", "TSL West Bokaro Q-AB", "Joda Iron Ore Mines"], "ULTRATECH LTD": ["Rajshree Cements", "Kotputli Cement Works", "Manikgarh Cement Works", "Bela Cement Works", "Awarpur", "Kukurdih Cement Works", "Nathwara Cement Works", "Tadipatri Cement Works", "Rawan Cement Works", "Maihar Cement Works"], "AMBUJA CEMENTS LTD": ["Ambuja Darlaghat", "Rabriyawas Cement Works"], "LAFARGE": ["Shella Lime Stone Quarry"], "ACC LTD": ["Wadi Cement Works", "Gagal Cement Works", "Kymore Cement Works"], "ADANI ENTERPRISES": ["Parsa Kenta Coal Mines"], "NMDC LTD": ["BACHELI", "KIRANDUL"], "JSW LTD": ["Nuagaon Iron Ore Mines", "Narayanposhi Iron Ore Mines"], "BIRLA CORPORATION LIMITED": ["Birla Cements Satna"], "GANPATI METAL MINING": ["MOIL"] };
    const siteToFleet = { "Ambuja Darlaghat": ["DarlaghatT40"], "Wadi Cement Works": ["WadiSRD50", "WadiFRD50"], "Rabriyawas Cement Works": ["RbwsD50I", "RbwsD50II"], "Rajshree Cements": ["RjshreeROCL6", "RjshreeFRD50"], "Noamundi Iron Ore Mines": ["NoaD65I", "NoaD65II", "NoaD65III", "KTMD65I", "KTMD65II"], "Kotputli Cement Works": ["KotputliT40I", "KotputliT40II", "KotputliT40III"], "Manikgarh Cement Works": ["ManikgarhT40I"], "Khondbond Iron Ore Mines": ["KhondbondD65", "KhondbondL8"], "Shella Lime Stone Quarry": ["LafargeD60", "LafargeT40"], "Bela Cement Works": ["BelaFRD50","IBH10-202104147"], "Joda Iron Ore Mines": ["JodaD65I", "JodaD65II"], "Narayanposhi Iron Ore Mines": ["NposhiT45I", "NposhiT45II"], "Nuagaon Iron Ore Mines": ["NuagaonT45III"], "TSL West Bokaro Q-SE": ["BokaroD65I", "BokaroPRD50", "QSE-DM14", "QSE-DM15"], "TSL West Bokaro Q-AB": ["QAB-DM2K10", "QAB-DM2K11"], "Gagal Cement Works": ["GagalFRD50", "GagalT40"], "Kymore Cement Works": ["KymoreT40I", "KymoreMGMFRD50", "KymoreBMGFRD50"], "Awarpur": ["AwarpurD50I"], "Kukurdih Cement Works": ["KukurdihT45I"], "Nathwara Cement Works": ["NathwaraT40I", "NathwaraT40II"], "Tadipatri Cement Works": ["TadipatriT45I"], "Rawan Cement Works": ["RawanD50I"], "Maihar Cement Works": ["MaiharT40I"], "Parsa Kenta Coal Mines": ["US091130"], "Birla Cements Satna": ["BirlaT40I"], "BACHELI": ["NMDCT45I", "NMDCT45III", "NMDCT45IV"], "KIRANDUL": ["NMDCT45II"], "MOIL": ["GanpatiT40I"] };

    function updateSites() {
        const customer = document.getElementById('customerSelect').value;
        const siteSelect = document.getElementById('workSiteSelect');
        const fleetSelect = document.getElementById('fleetSelect');
        siteSelect.innerHTML = '<option value="">-- Select Site --</option>';
        fleetSelect.innerHTML = '<option value="">-- Select Fleet --</option>';
        if (customerToSites[customer]) {
            customerToSites[customer].forEach(s => { let opt = document.createElement('option'); opt.value = opt.text = s; siteSelect.add(opt); });
        }
    }

    function updateFleet() {
        const site = document.getElementById('workSiteSelect').value;
        const fleetSelect = document.getElementById('fleetSelect');
        fleetSelect.innerHTML = '<option value="">-- Select Fleet --</option>';
        if (siteToFleet[site]) {
            siteToFleet[site].forEach(f => { let opt = document.createElement('option'); opt.value = opt.text = f; fleetSelect.add(opt); });
        }
    }

   function checkValidation() {
    // 1. Instant Correction: Reset to 0 if out of range
    const activeEl = document.activeElement;
    if (activeEl && activeEl.type === 'number') {
        forceLimitToZero(activeEl);
    }

    // 2. Button Enabling Logic (Checking Required Fields)
    const requiredFields = [
        document.getElementById('customerSelect').value,
        document.getElementById('valDate').value,
        document.getElementById('valTech').value,
        document.getElementById('workSiteSelect').value,
        document.getElementById('fleetSelect').value,
        document.getElementById('valShift').value,
        document.getElementById('valEngTemp').value,
        document.getElementById('valEngOil').value
    ];

    // Enable button only if all required fields are filled
    document.getElementById('submitBtn').disabled = requiredFields.some(v => !v || v.trim() === "");
}

function forceLimitToZero(input) {
    if (!input.min || !input.max) return;
    
    let val = parseFloat(input.value);
    let min = parseFloat(input.min);
    let max = parseFloat(input.max);

    if (isNaN(val)) return;

    // Instant Correction: Reset to 0 if out of bounds
    if (val > max || (val < min && input.value.length >= String(min).length)) {
        input.value = 0; 
        input.style.backgroundColor = "#ffcccc"; // Red flash for error
        alert("Invalid Entry! Must be between " + min + " and " + max + ". Value reset to 0.");
        
        setTimeout(() => { 
            input.style.backgroundColor = ""; 
        }, 300);
        
        input.focus(); 
    }
}


    document.getElementById('passInput').addEventListener('input', function() {
        const match = this.value === passKey;
        document.getElementById('protectedContent').classList.toggle('hidden', !match);
        document.getElementById('formButtons').classList.toggle('hidden', !match);
        document.getElementById('statusLabel').innerText = match ? "Unlocked" : "Locked";
        document.getElementById('statusLabel').className = "status-tag " + (match ? "unlocked" : "locked");
        checkValidation();
    });

    // Use only this line - it finds the form that actually contains the button
const parameterForm = document.querySelector('form'); 

// Check if the form actually exists before adding the listener
if (parameterForm) {
    parameterForm.addEventListener('submit', function(e) {
        e.preventDefault();
        
        const btn = e.target.querySelector('button[type="submit"]');
        btn.disabled = true;
        btn.innerText = "Sending to India...";

        let formData = new FormData(parameterForm);
        formData.append("password", passKey); 

        fetch(scriptURL, {
            method: 'POST',
            mode: 'no-cors', 
            body: formData
        })
        .then(() => {
            alert("‚úÖ SUCCESS: Data sent to Sheet and Firebase!");
            btn.disabled = false;
            btn.innerText = "Submit";
            parameterForm.reset(); 
        })
        .catch(err => {
            console.error("Submission Error:", err);
            alert("‚ùå FAILED: Check your internet or GS deployment.");
            btn.disabled = false;
            btn.innerText = "Submit";
        });
    });
} else {
    console.error("Error: Could not find the form element on this page.");
}
    function showSuccess() {
        const overlay = document.createElement('div');
        overlay.style = "position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.7);display:flex;justify-content:center;align-items:center;z-index:9999;";
        overlay.innerHTML = '<div style="background:white;padding:30px;border-radius:10px;text-align:center;"><div style="color:#28a745;font-size:50px;">‚úî</div><h3>Data Captured!</h3><p>Record saved to Sheet.</p></div>';
        document.body.appendChild(overlay);
        setTimeout(() => { overlay.remove(); }, 3000);
    }
</script> 
</body>
</html>








