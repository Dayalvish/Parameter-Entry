function doGet(e) {
  var sheet = SpreadsheetApp.getActiveSpreadsheet().getSheetByName("ParameterDb");
  var fleetId = e.parameter.fleetId;
  var data = sheet.getDataRange().getValues();
  var result = null;

  // Search from bottom to top to find the NEWEST entry
  for (var i = data.length - 1; i >= 1; i--) {
    if (data[i][6] == fleetId) { // Column 6 is Fleet ID (G)
      result = data[i];
      break;
    }
  }
  
  return ContentService.createTextOutput(JSON.stringify(result))
    .setMimeType(ContentService.MimeType.JSON);
}

function doPost(e) {
  var sheet = SpreadsheetApp.getActiveSpreadsheet().getSheetByName("ParameterDb");
  var headers = sheet.getRange(1, 1, 1, sheet.getLastColumn()).getValues()[0];
  var newRow = headers.map(function(header) {
    return e.parameter[header] || "";
  });
  sheet.appendRow(newRow);
  return ContentService.createTextOutput("Success").setMimeType(ContentService.MimeType.TEXT);
}
