<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EPIROC FLEET PARAMETER ENTRY FORM</title>
    <style>
        body { font-family: 'Segoe UI', Arial, sans-serif; background-color: #f0f2f5; padding: 20px; margin: 0; }
        .header-section { max-width: 700px; margin: 0 auto 10px auto; display: flex; flex-direction: column; align-items: flex-start; }
        .brand-logo { max-width: 160px; height: auto; margin-bottom: 10px; }
        h2 { margin: 0; font-size: 20px; color: #333; width: 100%; text-align: center; padding-bottom: 15px; }
        .sheet-container { background: white; border: 1px solid #ccc; box-shadow: 0 2px 10px rgba(0,0,0,0.1); max-width: 700px; margin: 0 auto; border-radius: 8px; overflow: hidden; }
        table { border-collapse: collapse; width: 100%; }
        td { border: 1px solid #dfe3e8; padding: 12px; font-size: 14px; }
        tr:nth-child(odd) .label-cell { background-color: #FFD700 !important; color: #000 !important; font-weight: bold; width: 45%; }
        tr:nth-child(even) .label-cell { background-color: #555555 !important; color: #ffffff !important; font-weight: bold; width: 45%; }
        input, select { width: 100%; padding: 8px; border: 1px solid #ced4da; border-radius: 4px; box-sizing: border-box; }
        .hidden { display: none; }
        .button-group { padding: 20px; text-align: center; background: #f8f9fa; border-top: 1px solid #ddd; }
        button { padding: 10px 25px; margin: 5px; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; transition: 0.3s; }
        .btn-submit { background-color: #28a745; color: white; }
        .btn-submit:disabled { background-color: #ccc; cursor: not-allowed; opacity: 0.6; }
        .status-tag { padding: 4px 8px; border-radius: 12px; font-size: 12px; font-weight: bold; }
        .locked { background: #f8d7da; color: #721c24; }
        .unlocked { background: #d4edda; color: #155724; }
        .required-star { color: #dc3545; }
    </style>
</head>
<body>

    <div class="header-section">
        <img src="Picture1.png" alt="Epiroc Logo" class="brand-logo" onerror="this.style.display='none'">
        <h2>EPIROC FLEET PARAMETER ENTRY FORM</h2>
    </div>

    <form id="residencyForm">
        <div class="sheet-container">
            <table>
                <tr><td class="label-cell">Customer Name <span class="required-star">*</span></td><td><select id="customerSelect" name="Customer Name" onchange="updateSites(); checkValidation();" required><option value="">-- Select --</option><option value="TATA STEEL LTD">TATA STEEL LTD</option><option value="ULTRATECH LTD">ULTRATECH LTD</option><option value="AMBUJA CEMENTS LTD">AMBUJA CEMENTS LTD</option><option value="ACC LTD">ACC LTD</option><option value="LAFARGE">LAFARGE</option><option value="JSW LTD">JSW LTD</option><option value="ADANI ENTERPRISES">ADANI ENTERPRISES</option><option value="NMDC LTD">NMDC LTD</option><option value="BIRLA CORPORATION LIMITED">BIRLA CORPORATION LIMITED</option><option value="GANPATI METAL MINING">GANPATI METAL MINING</option></select></td></tr>
                <tr><td class="label-cell">Date <span class="required-star">*</span></td><td><input type="date" name="Date" id="valDate" oninput="checkValidation()" required></td></tr>
                <tr><td class="label-cell">Technician Name <span class="required-star">*</span></td><td><input type="text" name="Technician Name" id="valTech" oninput="checkValidation()" required></td></tr>
                <tr><td class="label-cell">Unlock Password</td><td><input type="password" id="passInput" placeholder="Enter password"></td></tr>
                <tr><td class="label-cell">Status</td><td><span id="statusLabel" class="status-tag locked">Locked</span></td></tr>

                <tbody id="protectedContent" class="hidden">
                    <tr><td class="label-cell">Work Site <span class="required-star">*</span></td><td><select id="workSiteSelect" name="Work Site" onchange="updateFleet(); checkValidation();"><option value="">-- Select Site --</option></select></td></tr>
                    <tr><td class="label-cell">Fleet ID <span class="required-star">*</span></td><td><select id="fleetSelect" name="Fleet ID" onchange="checkValidation()"><option value="">-- Select Fleet --</option></select></td></tr>
                    <tr>
    <td class="label-cell">Recent Entry Lookup</td>
    <td>
        <button type="button" onclick="lookupRecentData()" style="background:#007bff; color:white; width:100%;">Fetch Last Entry for this Fleet</button>
    </td>
</tr>
                    <tr><td class="label-cell">Shift <span class="required-star">*</span></td><td><select name="Shift" id="valShift" onchange="checkValidation()"><option value="">-- Select Shift --</option><option>Shift A</option><option>Shift B</option><option>Shift C</option><option>G Shift</option></select></td></tr>
                    
                    <tr><td class="label-cell">Rotation Pressure</td><td><input type="number" step="any" name="Rotation Pressure"></td></tr>
                    <tr><td class="label-cell">Rotation RPM (Smartroc & PV)</td><td><input type="number" step="any" name="Rotation RPM (Smartroc & PV)"></td></tr>
                    <tr><td class="label-cell">Receiver Pr NoLoad (DTH & DS)</td><td><input type="number" step="any" name="Receiver Pr NoLoad (DTH & DS)"></td></tr>
                    <tr><td class="label-cell">Receiver Pr Unload (DTH & DS)</td><td><input type="number" step="any" name="Receiver Pr Unload (DTH & DS)"></td></tr>
                    <tr><td class="label-cell">Receiver Pr Load (DTH & DS)</td><td><input type="number" step="any" name="Receiver Pr Load (DTH & DS)"></td></tr>
                    <tr><td class="label-cell">Reduced Air pressure (DTH)</td><td><input type="number" step="any" name="Reduced Air pressure (DTH)"></td></tr>
                    <tr><td class="label-cell">Full Air Set Pr (DTH)</td><td><input type="number" step="any" name="Full Air Set Pr (DTH)"></td></tr>
                    <tr><td class="label-cell">Low Impact (Top Hammer)</td><td><input type="number" step="any" name="Low Impact (Top Hammer)"></td></tr>
                    <tr><td class="label-cell">Air Pressure Full</td><td><input type="number" step="any" name="Air Pressure Full"></td></tr>
                    <tr><td class="label-cell">Interstage Pr Load (DTH)</td><td><input type="number" step="any" name="Interstage Pr Load (DTH)"></td></tr>
                    <tr><td class="label-cell">Feed Pr Low Impact</td><td><input type="number" step="any" name="Feed Pr Low Impact"></td></tr>
                    <tr><td class="label-cell">Feed Pr High Impact</td><td><input type="number" step="any" name="Feed Pr High Impact"></td></tr>
                    <tr><td class="label-cell">HECL pr High Impact</td><td><input type="number" step="any" name="HECL pr High Impact"></td></tr>
                    <tr><td class="label-cell">DCT (%)</td><td><input type="number" step="any" name="DCT (%)"></td></tr>
                    <tr><td class="label-cell">Water injection (%)</td><td><input type="number" step="any" name="Water injection (%)"></td></tr>
                    <tr><td class="label-cell">Compressor Load (Smartroc & PV)</td><td><input type="number" step="any" name="Compressor Load (Smartroc & PV)"></td></tr>
                    <tr><td class="label-cell">Engine RPM Drilling</td><td><input type="number" step="any" name="Engine RPM Drilling"></td></tr>
                    <tr><td class="label-cell">Engine Temp <span class="required-star">*</span></td><td><input type="number" step="any" name="Engine Temp" id="valEngTemp" oninput="checkValidation()"></td></tr>
                    <tr><td class="label-cell">Hyd-Oil Temp</td><td><input type="number" step="any" name="Hyd-Oil Temp"></td></tr>
                    <tr><td class="label-cell">Ambient Temp</td><td><input type="number" step="any" name="Ambient Temp"></td></tr>
                    <tr><td class="label-cell">Engine load Drilling</td><td><input type="number" step="any" name="Engine load Drilling"></td></tr>
                    <tr><td class="label-cell">Boost Pressure</td><td><input type="number" step="any" name="Boost Pressure"></td></tr>
                    <tr><td class="label-cell">Engine oil pressure <span class="required-star">*</span></td><td><input type="number" step="any" name="Engine oil pressure" id="valEngOil" oninput="checkValidation()"></td></tr>
                    <tr><td class="label-cell">Air intake temp</td><td><input type="number" step="any" name="Air intake temp"></td></tr>
                    <tr><td class="label-cell">Compressor Temp (L & DS)</td><td><input type="number" step="any" name="Compressor Temp (L & DS)"></td></tr>
                    <tr><td class="label-cell">Compressor Temp (SRT40-T45& DTH) (H) (DTH)</td><td><input type="number" step="any" name="Compressor Temp (SRT40-T45& DTH) (H) (DTH)"></td></tr>
                    <tr><td class="label-cell">Charging Voltage</td><td><input type="number" step="any" name="Charging Voltage"></td></tr>
                    <tr><td class="label-cell">Fuel Pressure</td><td><input type="number" step="any" name="Fuel Pressure"></td></tr>
                    <tr><td class="label-cell">Tramming</td><td><input type="number" step="any" name="Tramming"></td></tr>
                    <tr><td class="label-cell">Y193 Inlet Pressure (Smartroc)</td><td><input type="number" step="any" name="Y193 Inlet Pressure (Smartroc)"></td></tr>
                    <tr><td class="label-cell">High Impact (Top Hammer)</td><td><input type="number" step="any" name="High Impact (Top Hammer)"></td></tr>
                    <tr><td class="label-cell">Damper Pressure High (Top Hammer)</td><td><input type="number" step="any" name="Damper Pressure High (Top Hammer)"></td></tr>
                    <tr><td class="label-cell">Feed Pr Coupling</td><td><input type="number" step="any" name="Feed Pr Coupling"></td></tr>
                    <tr><td class="label-cell">Feed Pr Uncoupling</td><td><input type="number" step="any" name="Feed Pr Uncoupling"></td></tr>
                    <tr><td class="label-cell">Rotation Pr Rod To Rod</td><td><input type="number" step="any" name="Rotation Pr Rod To Rod"></td></tr>
                </tbody>
            </table>
            
            <div class="button-group hidden" id="formButtons">
                <button type="submit" id="submitBtn" class="btn-submit" disabled>Submit Record</button>
            </div>
        </div>
    </form>

    <script>
    // Scrambled Connection (Updated with new URL: ...BIDA/exec)
  var _0x1a2b=["\x45\x70\x69\x72\x6f\x63\x40\x31\x32\x33","\x68\x74\x74\x70\x73\x3a\x2f\x2f\x73\x63\x72\x69\x70\x74\x2e\x67\x6f\x6f\x67\x6c\x65\x2e\x63\x6f\x6d\x2f\x6d\x61\x63\x72\x6f\x73\x2f\x73\x2f\x41\x4b\x66\x79\x63\x62\x7a\x5f\x78\x77\x74\x6b\x76\x55\x76\x64\x30\x5a\x57\x44\x38\x7a\x50\x38\x6c\x57\x6b\x59\x57\x55\x55\x74\x30\x68\x33\x6c\x47\x6b\x6e\x4a\x57\x4d\x74\x69\x69\x49\x70\x4b\x49\x48\x59\x7a\x62\x6b\x35\x64\x39\x4d\x6e\x71\x79\x4f\x42\x56\x79\x63\x61\x55\x70\x36\x44\x48\x2f\x65\x78\x65\x63"];
const scriptURL = _0x1a2b[1];
const passKey = _0x1a2b[0];
    // New Data Fetch Implementation
    function lookupRecentData() {
        const fId = document.getElementById('fleetSelect').value;
        if (!fId) { alert("Select Fleet ID first"); return; }
        
        const btn = event.target;
        btn.innerText = "Searching..."; btn.disabled = true;

        // Fetching latest entry based ONLY on Fleet ID to ensure reliability
        fetch(scriptURL + "?fleetId=" + encodeURIComponent(fId))
        .then(r => r.json())
        .then(d => {
            if (d && d.length > 0) {
                // Selects all number inputs to auto-fill
                const ins = document.querySelectorAll('input[type="number"]');
                ins.forEach((input, i) => { 
                    // Maps Column I (Index 8) to the first parameter input
                    if(d[i+8] !== undefined && d[i+8] !== "") {
                        input.value = d[i+8];
                    }
                });
                alert("Latest parameters for " + fId + " loaded successfully.");
            } else { 
                alert("No previous records found for this Fleet ID."); 
            }
        })
        .catch(e => alert("Under Progress. will be functional shortly'."))
        .finally(() => { 
            btn.innerText = "Fetch Last Entry for this Fleet"; 
            btn.disabled = false; 
        });
    }
 // --- Technical Logic ---
    const customerToSites = { "TATA STEEL LTD": ["Noamundi Iron Ore Mines", "Khondbond Iron Ore Mines", "TSL West Bokaro Q-SE", "TSL West Bokaro Q-AB", "Joda Iron Ore Mines"], "ULTRATECH LTD": ["Rajshree Cements", "Kotputli Cement Works", "Manikgarh Cement Works", "Bela Cement Works", "Awarpur", "Kukurdih Cement Works", "Nathwara Cement Works", "Tadipatri Cement Works", "Rawan Cement Works", "Maihar Cement Works"], "AMBUJA CEMENTS LTD": ["Ambuja Darlaghat", "Rabriyawas Cement Works"], "LAFARGE": ["Shella Lime Stone Quarry"], "ACC LTD": ["Wadi Cement Works", "Gagal Cement Works", "Kymore Cement Works"], "ADANI ENTERPRISES": ["Parsa Kenta Coal Mines"], "NMDC LTD": ["BACHELI", "KIRANDUL"], "JSW LTD": ["Nuagaon Iron Ore Mines", "Narayanposhi Iron Ore Mines"], "BIRLA CORPORATION LIMITED": ["Birla Cements Satna"], "GANPATI METAL MINING": ["MOIL"] };
    const siteToFleet = { "Ambuja Darlaghat": ["DarlaT40"], "Wadi Cement Works": ["WadiSRD50", "WadiFRD50"], "Rabriyawas Cement Works": ["RbwsD50I", "RbwsD50II"], "Rajshree Cements": ["RjshreeROCL6", "RjshreeFRD50"], "Noamundi Iron Ore Mines": ["NoaD65I", "NoaD65II", "NoaD65III", "KTMD65I", "KTMD65II"], "Kotputli Cement Works": ["KotputliT40I", "KotputliT40II", "KotputliT40III"], "Manikgarh Cement Works": ["ManikgarhT40"], "Khondbond Iron Ore Mines": ["KhondbondD65", "KhondbondL8"], "Shella Lime Stone Quarry": ["LafargeD60", "LafargeT40"], "Bela Cement Works": ["BelaFRD50"], "Joda Iron Ore Mines": ["JodaD65I", "JodaD65II"], "Narayanposhi Iron Ore Mines": ["NposhiT45I", "NposhiT45II"], "Nuagaon Iron Ore Mines": ["NuagaonT45III"], "TSL West Bokaro Q-SE": ["BokaroD65I", "BokaroPRD50", "QSE-DM14", "QSE-DM15"], "TSL West Bokaro Q-AB": ["QAB-DM2K10", "QAB-DM2K11"], "Gagal Cement Works": ["GagalFRD50", "GagalT40"], "Kymore Cement Works": ["KymoreT40", "KymoreMGMFRD50", "KymoreBMGFRD50"], "Awarpur": ["AwarpurD50I"], "Kukurdih Cement Works": ["KukurdihT45I"], "Nathwara Cement Works": ["NathwaraT40I", "NathwaraT40II"], "Tadipatri Cement Works": ["TadipatriT45I"], "Rawan Cement Works": ["RawanD50I"], "Maihar Cement Works": ["MaiharT40I"], "Parsa Kenta Coal Mines": ["US091130"], "Birla Cements Satna": ["BirlaT40I"], "BACHELI": ["NMDCT45I", "NMDCT45III", "NMDCT45IV"], "KIRANDUL": ["NMDCT45II"], "MOIL": ["GanpatiT40I"] };

    function updateSites() {
        const customer = document.getElementById('customerSelect').value;
        const siteSelect = document.getElementById('workSiteSelect');
        const fleetSelect = document.getElementById('fleetSelect');
        siteSelect.innerHTML = '<option value="">-- Select Site --</option>';
        fleetSelect.innerHTML = '<option value="">-- Select Fleet --</option>';
        if (customerToSites[customer]) {
            customerToSites[customer].forEach(s => { let opt = document.createElement('option'); opt.value = opt.text = s; siteSelect.add(opt); });
        }
    }

    function updateFleet() {
        const site = document.getElementById('workSiteSelect').value;
        const fleetSelect = document.getElementById('fleetSelect');
        fleetSelect.innerHTML = '<option value="">-- Select Fleet --</option>';
        if (siteToFleet[site]) {
            siteToFleet[site].forEach(f => { let opt = document.createElement('option'); opt.value = opt.text = f; fleetSelect.add(opt); });
        }
    }

    function checkValidation() {
        const fields = [document.getElementById('customerSelect').value, document.getElementById('valDate').value, document.getElementById('valTech').value, document.getElementById('workSiteSelect').value, document.getElementById('fleetSelect').value, document.getElementById('valShift').value, document.getElementById('valEngTemp').value, document.getElementById('valEngOil').value];
        document.getElementById('submitBtn').disabled = fields.some(v => !v || v.trim()==="");
    }

    document.getElementById('passInput').addEventListener('input', function() {
        const match = this.value === passKey;
        document.getElementById('protectedContent').classList.toggle('hidden', !match);
        document.getElementById('formButtons').classList.toggle('hidden', !match);
        document.getElementById('statusLabel').innerText = match ? "Unlocked" : "Locked";
        document.getElementById('statusLabel').className = "status-tag " + (match ? "unlocked" : "locked");
        checkValidation();
    });

    const form = document.getElementById('residencyForm');
    form.addEventListener('submit', e => {
        e.preventDefault();
        const btn = document.getElementById('submitBtn');
        btn.innerText = "Processing..."; btn.disabled = true;
        fetch(scriptURL, { method: 'POST', body: new FormData(form)})
        .then(() => { showSuccess(); form.reset(); updateSites(); btn.innerText = "Submit Record"; })
        .catch(() => { alert("Failed."); btn.disabled = false; btn.innerText = "Submit Record"; });
    });

    function showSuccess() {
        const overlay = document.createElement('div');
        overlay.style = "position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.7);display:flex;justify-content:center;align-items:center;z-index:9999;";
        overlay.innerHTML = '<div style="background:white;padding:30px;border-radius:10px;text-align:center;"><div style="color:#28a745;font-size:50px;">âœ”</div><h3>Data Captured!</h3><p>Record saved to Sheet.</p></div>';
        document.body.appendChild(overlay);
        setTimeout(() => { overlay.remove(); }, 3000);
    }
</script> 
</body>
</html>






